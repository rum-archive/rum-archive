<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/main.css" />
  <script src="/js/main.js"></script>
  <title>RUM Archive - Tips</title>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#006a80">
  <meta name="msapplication-TileColor" content="#006a80">
  <meta name="theme-color" content="#006a80">

  <!-- Facebook Meta Tags -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="RUM Archive - Tips">
  <meta property="og:image" content="https://rumarchive.com/assets/rum-archive-banner-facebook-1200x630.png">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="twitter:domain" content="rumarchive.com">
  <meta name="twitter:title" content="RUM Archive - Tips">
  <meta name="twitter:image" content="https://rumarchive.com/assets/rum-archive-banner-twitter-1600x900.png">

  <link rel="feed alternate" type="application/atom+xml" href="/blog/feed.xml" title="Atom Feed">

  <script>(function(){if(window.BOOMR&&(window.BOOMR.version||window.BOOMR.snippetExecuted)){return}window.BOOMR=window.BOOMR||{};window.BOOMR.snippetStart=(new Date).getTime();window.BOOMR.snippetExecuted=true;window.BOOMR.snippetVersion=15;window.BOOMR.url="//c.go-mpulse.net/boomerang/S4RHZ-UABWM-G9DGN-GKRY7-DUGEG";var e=document.currentScript||document.getElementsByTagName("script")[0],a=e.parentNode,s=false,t=3e3;function n(){if(s){return}var e=document.createElement("script");e.id="boomr-scr-as";e.src=window.BOOMR.url;e.async=true;a.appendChild(e);s=true}function i(e){s=true;var t,i=document,n,o,d,r=window;window.BOOMR.snippetMethod=e?"if":"i";n=function(e,t){var n=i.createElement("script");n.id=t||"boomr-if-as";n.src=window.BOOMR.url;BOOMR_lstart=(new Date).getTime();e=e||i.body;e.appendChild(n)};if(!window.addEventListener&&window.attachEvent&&navigator.userAgent.match(/MSIE [678]\./)){window.BOOMR.snippetMethod="s";n(a,"boomr-async");return}o=document.createElement("IFRAME");o.src="about:blank";o.title="";o.role="presentation";o.loading="eager";d=(o.frameElement||o).style;d.width=0;d.height=0;d.border=0;d.display="none";a.appendChild(o);try{r=o.contentWindow;i=r.document.open()}catch(e){t=document.domain;o.src="javascript:var d=document.open();d.domain='"+t+"';void 0;";r=o.contentWindow;i=r.document.open()}r._boomrl=function(){n()};if(r.addEventListener){r.addEventListener("load",r._boomrl,false)}else if(r.attachEvent){r.attachEvent("onload",r._boomrl)}i.close()}var o=document.createElement("link");if(o.relList&&typeof o.relList.supports==="function"&&o.relList.supports("preload")&&"as"in o){window.BOOMR.snippetMethod="p";o.href=window.BOOMR.url;o.rel="preload";o.as="script";o.addEventListener("load",n);o.addEventListener("error",function(){i(true)});setTimeout(function(){if(!s){i(true)}},t);BOOMR_lstart=(new Date).getTime();a.appendChild(o)}else{i(false)}function d(e){window.BOOMR_onload=e&&e.timeStamp||(new Date).getTime()}if(window.addEventListener){window.addEventListener("load",d,false)}else if(window.attachEvent){window.attachEvent("onload",d)}})();</script>
</head>
<body>
  <header><nav class="navbar is-light" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="/">
      <img src="/assets/rum-archive-logo-square.svg" width="28" height="28" />
    </a>

    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbar-main">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>

  <div id="navbar-main" class="navbar-menu">
    <div class="navbar-start">
      <div class="navbar-item has-text-weight-bold">
        <a href="/">RUM Archive</a>
      </div>
    </div>

    <div class="navbar-end">
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="/docs/">
          Documentation
        </a>

        <div class="navbar-dropdown">
          <a class="navbar-item" href="/docs/methodology">
            Methodology
          </a>
          <a class="navbar-item" href="/docs/querying">
            Querying
          </a>
          <a class="navbar-item" href="/docs/tables">
            Tables
          </a>
          <a class="navbar-item" href="/docs/samples">
            Samples
          </a>
          <a class="navbar-item" href="/docs/tips">
            Tips
          </a>
          <a class="navbar-item" href="/docs/release-notes">
            Release  Notes
          </a>
        </div>
      </div>

      <a href="/datasets" class="navbar-item">
        Datasets
      </a>

      <a href="/blog" class="navbar-item">
        Blog
      </a>

      <a href="/insights" class="navbar-item">
        Insights
      </a>

      <a href="/contribute" class="navbar-item">
        Contribute!
      </a>

      <a href="https://github.com/rum-archive/rum-archive" class="navbar-item">
        Github
      </a>

      <a href="/about" class="navbar-item">
        About
      </a>
    </div>
  </div>
</nav>
</header>
  <main>
    
<article class="page-layout">
  <div class="container">
    <div class="columns">
      <div class="column is-10 is-offset-1">
        <div class="content m-5">
          <h1>Tips</h1>
          
            <h2>Table of Contents</h2>
            <aside>
              <div class="toc" >
        <ul><li><a href="#data-is-sampled">Data is sampled</a></li><li><a href="#counts-should-only-be-used-for-relative-percentages">Counts should only be used for relative percentages</a></li><li><a href="#outliers-are-excluded">Outliers are excluded</a></li><li><a href="#zeroes-matter-(or-not)">Zeroes matter (or not)</a></li><li><a href="#data-sets-should-not-be-compared">Data sets should not be compared</a></li><li><a href="#limiting-bigquery-costs">Limiting BigQuery costs</a></li><li><a href="#bigquery-udf-out-of-memory">BigQuery UDF Out of Memory</a></li><li><a href="#not-every-timer-is-available-on-every-row">Not Every Timer is Available on Every Row</a></li></ul>
      </div>
            </aside>
          
          <h2 id="data-is-sampled" tabindex="-1">Data is sampled</h2>
<p>Most of the data in the RUM Archive is <strong>sampled</strong>.</p>
<p>The sampling rate may not be publicly disclosed, so <code>BEACONS</code> counts should only be used for <a href="#counts-should-only-be-used-for-relative-percentages"><em>relative</em> weighting</a> for that day.</p>
<p>The sampling rate <em>may</em> also change from day-to-day.</p>
<p>Some <a href="/datasets">datasets</a> may not be sampled. For example, the <a href="/datasets#akamai-employee-individual-websites-datasets">Akamai Employee Individual Datasets</a> contain all of the page load events for each day.</p>
<h2 id="counts-should-only-be-used-for-relative-percentages" tabindex="-1">Counts should only be used for relative percentages</h2>
<p>When <a href="#data-is-sampled">data is sampled</a>, absolute counts of <code>BEACONS</code> should only be used to compare data on the same <code>DATE</code> in a single dataset.</p>
<p>As the sampling rate may change from day-to-day, absolute count comparisons <em>between days</em> should not be used, only <em>relative weights</em>.</p>
<p>See the <a href="/docs/samples/#dimension-popularity-(as-a-percentage-of-total)">sample queries</a> for examples of how to calculate relative weights.</p>
<h2 id="outliers-are-excluded" tabindex="-1">Outliers are excluded</h2>
<p>Most of the data in the RUM Archive is <a href="#data-is-sampled">sampled</a>, <a href="/docs/methodology/#aggregation">aggregated</a>, and only rows that meet the <a href="/docs/methodology/#minimum-count-threshold">Minimum Count Threshold</a> are included.</p>
<p>The downside of applying a Minimum Count Threshold is that <strong>outliers</strong>, by definition, will be discarded and not represented
in the queryable dataset.</p>
<p>Discarding outliers <strong>will affect</strong> the accuracy of queries.  For example, in the mPulse dataset, we estimate that discarding any tuples with less than 5 hits could affect 50th percentile (median) calculations by around 2.9% and 95th percentile calculations by 7%.  Please take this into consideration when querying the data.</p>
<p>The <a href="/datasets#akamai-employee-individual-websites-datasets">Akamai Employee Individual Datasets</a> are not sampled, so &quot;include&quot; all outliers.</p>
<h2 id="zeroes-matter-(or-not)" tabindex="-1">Zeroes matter (or not)</h2>
<p>When querying Timer or Metric percentiles via the <a href="/docs/querying/#approximate-percentiles"><code>PERCENTILE_APPROX</code></a> function, you will need to consider whether you want to include &quot;zeros&quot; in the percentile calculation.</p>
<p>For some Timers or Metrics, including zeros makes sense.  For example, Cumulative Layout Shifts can have a value of <code>0.0</code>, meaning no shifts happened.  This is <strong>good</strong> and represents the ideal page load (no shifts).  Including zeros will likely &quot;shift&quot; the <code>PERCENTILE_APPROX</code> calculation left (lower), by including those <code>0.0</code> page loads.</p>
<p>For other Timers like DNS, you may want to include or exclude zeros:</p>
<ul>
<li>If you're including zeros, you're including all page loads, even those that had no DNS lookup time (e.g. because DNS was cached).  This would be done to understand the percentile of DNS time for <strong>all</strong> of your page visits, whether or not they had to do a DNS lookup.</li>
<li>If you're <strong>not</strong> including zeros, you're only including page loads that had a DNS lookup (e.g. excluding those that had DNS cached).  This would be done to understand the DNS lookup time <strong>when</strong> DNS had to be queried.</li>
</ul>
<h2 id="data-sets-should-not-be-compared" tabindex="-1">Data sets should not be compared</h2>
<p>Each <a href="/datasets">dataset</a> comes from a different website (or set of websites), and is using a different collection, sampling and aggregation methodology.</p>
<p>As a result, datasets shouldn't be directly compared to one another unless you're looking at specific things that would not be affected by those caveats (such as understanding the relative weighting of Browser or Device Types seen).</p>
<p>The <a href="/datasets#akamai-employee-individual-websites-datasets">Akamai Employee Individual Datasets</a> are individually identifiable, and you'd usually want to segregate your queries based on the <code>SITE</code> column.</p>
<h2 id="limiting-bigquery-costs" tabindex="-1">Limiting BigQuery costs</h2>
<p>RUM Archive <a href="/docs/tables">tables</a> are partitioned by <code>DATE</code> to aid in reducing query costs.  When you're issuing a BigQuery query, you should almost always be using a <code>DATE</code> clause.</p>
<p>If you don't include a <code>DATE</code> clause, BigQuery may have to query the entire dataset.  Some datasets could be 100s of GBs or larger.</p>
<p>For example, a single day in the <a href="/datasets">mPulse RUM dataset</a> should only be 3-5 GB.  After a year of data, the entire mPulse dataset could be 2 TB or larger.</p>
<p>You may want to review what's available in the <a href="https://cloud.google.com/bigquery/pricing#free-tier">BigQuery free tier</a>, to try to stay under those limits.  With 1 TB of free queries, you should be able to run a few hundred queries against the mPulse dataset, when using a <code>DATE</code> filter.</p>
<p>BigQuery has an estimated query cost (in bytes) in the upper-right corner of the BigQuery console:</p>
<p><img src="/assets/tips-limiting-bigquery-costs-1.png" alt="Estimating BigQuery costs"></p>
<h2 id="bigquery-udf-out-of-memory" tabindex="-1">BigQuery UDF Out of Memory</h2>
<p>When using the <a href="docs/querying/#approximate-percentiles"><code>PERCENTILE_APPROX</code></a> function, BigQuery may run out of memory:</p>
<p><img src="/assets/tips-bigquery-udf-out-of-memory-1.png" alt="Estimating BigQuery costs"></p>
<p>This is because <code>PERCENTILE_APPROX</code> is a JavaScript function (UDF), and it is combining histograms to calculate the approximate percentile for each output row.  Sometimes, this work is too costly and BigQuery will run out of memory.</p>
<p>There are a few approaches to workaround this:</p>
<ol>
<li>Utilize <code>WHERE</code> clauses to filter to a subset of the data (see <a href="/docs/samples/#page-load-time-by-country">this example</a>)</li>
<li>Issue a sub-query against a high-cardinality dimension to break the dataset down first (see <a href="/docs/samples/#page-load-time-by-country-(using-a-subquery)">this example</a>)</li>
<li>Export the data and run your own queries or aggregation</li>
</ol>
<h2 id="not-every-timer-is-available-on-every-row" tabindex="-1">Not Every Timer is Available on Every Row</h2>
<p>When generating <a href="/docs/methodology/#aggregation">aggregated data</a> for BigQuery, the aggregation query contains a <code>WHERE</code> clause to only include rows that contain a Page Load Time.</p>
<p>Every timer, including Page Load Time, but also the other timers such as <a href="/docs/tables/#timers-and-metrics">DNS or Largest Contentful Paint</a> has 4 columns associated with it: <code>*HISTOGRAM</code>, <code>*AVG</code>, <code>*SUMLN</code> and <code>*COUNT</code>.  The last column, <code>*COUNT</code> records how frequently that timer appeared for that row's tuples of data.</p>
<p>Since the aggregation is pivoted on Page Load Time being available, you can expect the <code>BEACONS</code> column (how many page loads the row represents) to equal the <code>PLTCOUNT</code> exactly.  However, other timers may not be on every Page Load beacon.  For example:</p>
<ul>
<li>Events like Rage Clicks may not always happen</li>
<li>Timers like LCP may not have been recorded if the browser doesn't support the metric</li>
</ul>
<p>As a result, for the non-PLT timers, you may see a <code>*COUNT</code> column <em>lower</em> than the <code>BEACONS</code> and <code>PLTCOUNT</code> columns.</p>
<p>As an example, if you see <code>BEACONS == PLTCOUNT == 100</code> and <code>DNSCOUNT == 10</code> that means that DNS data was only recorded on 10% of the page loads represented by that row.</p>
<p>Here are the timer counts and the percentage of beacons they were on, for one day's worth of data (2023-09-30):</p>
<table>
<thead>
<tr>
<th style="text-align:left">Column</th>
<th style="text-align:right">Count</th>
<th style="text-align:right">% of Total</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>BEACONS</code></td>
<td style="text-align:right">169,613,083</td>
<td style="text-align:right">100.0%</td>
</tr>
<tr>
<td style="text-align:left"><code>PLTCOUNT</code></td>
<td style="text-align:right">169,613,083</td>
<td style="text-align:right">100.0%</td>
</tr>
<tr>
<td style="text-align:left"><code>DNSCOUNT</code></td>
<td style="text-align:right">169,228,821</td>
<td style="text-align:right">99.8%</td>
</tr>
<tr>
<td style="text-align:left"><code>TCPCOUNT</code></td>
<td style="text-align:right">169,225,189</td>
<td style="text-align:right">99.8%</td>
</tr>
<tr>
<td style="text-align:left"><code>TLSCOUNT</code></td>
<td style="text-align:right">169,212,909</td>
<td style="text-align:right">99.8%</td>
</tr>
<tr>
<td style="text-align:left"><code>TTFBCOUNT</code></td>
<td style="text-align:right">169,226,039</td>
<td style="text-align:right">99.8%</td>
</tr>
<tr>
<td style="text-align:left"><code>FCPCOUNT</code></td>
<td style="text-align:right">105,779,526</td>
<td style="text-align:right">62.4%</td>
</tr>
<tr>
<td style="text-align:left"><code>LCPCOUNT</code></td>
<td style="text-align:right">47,348,328</td>
<td style="text-align:right">27.9%</td>
</tr>
<tr>
<td style="text-align:left"><code>RTTCOUNT</code></td>
<td style="text-align:right">113,954,652</td>
<td style="text-align:right">67.2%</td>
</tr>
<tr>
<td style="text-align:left"><code>RAGECLICKSCOUNT</code></td>
<td style="text-align:right">1,607,443</td>
<td style="text-align:right">0.9%</td>
</tr>
<tr>
<td style="text-align:left"><code>CLSCOUNT</code></td>
<td style="text-align:right">31,071,715</td>
<td style="text-align:right">18.3%</td>
</tr>
<tr>
<td style="text-align:left"><code>FIDCOUNT</code></td>
<td style="text-align:right">22,833,581</td>
<td style="text-align:right">13.5%</td>
</tr>
<tr>
<td style="text-align:left"><code>INPCOUNT</code></td>
<td style="text-align:right">5,806,935</td>
<td style="text-align:right">3.4%</td>
</tr>
<tr>
<td style="text-align:left"><code>TBTCOUNT</code></td>
<td style="text-align:right">46,063,946</td>
<td style="text-align:right">27.2%</td>
</tr>
<tr>
<td style="text-align:left"><code>TTICOUNT</code></td>
<td style="text-align:right">64,364,940</td>
<td style="text-align:right">37.9%</td>
</tr>
<tr>
<td style="text-align:left"><code>REDIRECTCOUNT</code></td>
<td style="text-align:right">10,954,288</td>
<td style="text-align:right">6.5%</td>
</tr>
</tbody>
</table>

        </div>
      </div>
    </div>
  </div>
</article>

  </main>
  <footer class="footer">
    <div class="content has-text-centered">
      <p>
        Sponsored by <a href="https://akamai.com"><img src="/assets/akamai-logo.svg" style="position:relative;top:4px;height:26px" alt="Akamai logo"></a>
      </p>
      <p>
        The website content is licensed
        <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
      </p>
      <p>
        <a href="https://twitter.com/RUMArchive">twitter</a> -
        <a href="https://bsky.app/profile/rumarchive.com">bluesky</a> -
        <a rel="me" href="https://webperf.social/@rumarchive">mastodon</a>
      </p>
    </div>
  </footer>
</body>
</html>
